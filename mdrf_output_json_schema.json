{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "MDRF v3.0 Parser Output YAML Schema",
  "description": "JSON Schema for the YAML structure generated by the MdrfParser from an MDRF v3.0 file.",
  "type": "object",
  "properties": {
    "title": {
      "description": "The main title of the MDRF document, extracted from the H1 heading.",
      "type": "string"
    },
    "front_matter": {
      "description": "Content of the YAML Front Matter block.",
      "type": "object",
      "properties": {
        "mdrf_version": {
          "description": "MDRF version. Must be '3.0'.",
          "type": "string",
          "const": "3.0"
        },
        "project": {
          "description": "Name of the project.",
          "type": "string"
        },
        "review_date": {
          "description": "Date of the review (YYYY-MM-DD).",
          "type": "string",
          "format": "date"
        },
        "participants": {
          "description": "List of participants involved in the review.",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["mdrf_version"],
      "additionalProperties": true
    },
    "groups": {
      "description": "Array of groups (H2 level sections).",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Group"
      }
    }
  },
  "required": [
    "title",
    "front_matter",
    "groups"
  ],
  "definitions": {
    "Group": {
      "title": "Group Section (H2)",
      "type": "object",
      "properties": {
        "type": {
          "description": "Type of the group, extracted from the H2 heading (e.g., 'Version', 'Path').",
          "type": "string"
        },
        "name_id": {
          "description": "Name or identifier of the group, extracted from the H2 heading.",
          "type": "string"
        },
        "group_metadata": {
          "description": "Optional metadata for the group, parsed from a ```yaml block.",
          "type": "object",
          "properties": {
            "group_type": {
                "description": "Type of the group (e.g., 'version', 'path', 'feature'). Should ideally match the H2 heading type (lowercase recommended).",
                "type": "string"
            },
            "author": {
              "description": "Author (e.g., for commit/version group).",
              "type": "string"
            },
            "timestamp": {
              "description": "Timestamp (e.g., for commit/version group, ISO 8601 format).",
              "type": "string",
              "format": "date-time"
            },
            "base_commit": {
              "description": "The base identifier (e.g., commit ID) for comparison.",
              "type": "string"
            },
            "related_issue": {
              "description": "Identifier for related issues.",
              "type": "string"
            },
            "description": {
                "description": "A brief description of the group.",
                "type": "string"
            }
          },
          "additionalProperties": true
        },
        "files": {
          "description": "Array of files (H3 level sections) within this group.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/File"
          }
        }
      },
      "required": [
        "type",
        "name_id",
        "files"
      ]
    },
    "File": {
      "title": "File Section (H3)",
      "type": "object",
      "properties": {
        "path": {
          "description": "Path of the file, extracted from the H3 heading.",
          "type": "string"
        },
        "status": {
          "description": "Change status of the file (e.g., 'modified', 'added', 'renamed', 'moved', 'removed'). Derived from H3 or 'change_type' in metadata.",
          "type": "string",
          "enum": ["modified", "added", "renamed", "moved", "removed"]
        },
        "old_path": {
          "description": "Previous path of the file if renamed or moved. From 'old_path' in metadata.",
          "type": "string"
        },
        "metadata": {
          "description": "Optional metadata for the file, parsed from a ```yaml block.",
          "type": "object",
          "properties": {
            "file_path": {
              "description": "Path of the file. Must match the H3 heading path.",
              "type": "string"
            },
            "change_type": {
              "description": "Type of change.",
              "type": "string",
              "enum": ["added", "modified", "renamed", "moved", "removed"]
            },
            "old_path": {
              "description": "Previous path of the file if renamed or moved.",
              "type": "string"
            },
            "old_hash": {
              "description": "Git hash of the file before changes.",
              "type": "string"
            },
            "new_hash": {
              "description": "Git hash of the file after changes.",
              "type": "string"
            },
            "file_status": {
              "description": "Review status specific to this file (custom).",
              "type": "string"
            }
          },
          "required": ["file_path"],
          "additionalProperties": true
        },
        "diff": {
          "description": "The unified diff content for the file.",
          "type": "string"
        },
        "threads": {
          "description": "Array of comment threads (H4 level sections) related to this file.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Thread"
          }
        }
      },
      "required": [
        "path",
        "status",
        "diff",
        "threads"
      ]
    },
    "Thread": {
      "title": "Comment Thread Section (H4)",
      "type": "object",
      "properties": {
        "thread_number": {
          "description": "Sequential number of the thread within the file, extracted from H4.",
          "type": "integer",
          "minimum": 1
        },
        "line_number": {
          "description": "Optional line number in the new file version this thread refers to, from H4.",
          "type": "integer",
          "minimum": 1
        },
        "thread_meta": {
          "description": "Optional metadata for the thread, parsed from a ```yaml block.",
          "type": "object",
          "properties": {
            "status": {
              "description": "Current status of the discussion thread. Recommended values: 'open', 'addressed', 'resolved', 'wontfix'.",
              "type": "string"
            },
            "type": {
              "description": "Type or category of the discussion. Recommended values: 'issue', 'suggestion', 'question', 'nitpick'.",
              "type": "string"
            },
            "context_snippet": {
              "description": "Code snippet related to the thread. Can be multi-line.",
              "type": "string"
            },
            "severity": {
              "description": "Severity level (custom example).",
              "type": "string"
            }
          },
          "additionalProperties": true
        },
        "comments": {
          "description": "Array of individual comments (H5 level) within this thread.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/Comment"
          }
        }
      },
      "required": [
        "thread_number",
        "comments"
      ]
    },
    "Comment": {
      "title": "Individual Comment (H5)",
      "type": "object",
      "properties": {
        "id": {
          "description": "Optional unique identifier for the comment within the thread, from H5 (e.g., '[1.1]').",
          "type": "string"
        },
        "username": {
          "description": "Author's identifier for the comment, from H5.",
          "type": "string"
        },
        "timestamp": {
          "description": "Timestamp of the comment in ISO 8601 format, from H5.",
          "type": "string",
          "format": "date-time"
        },
        "reply_to": {
          "description": "Optional identifier of the comment this one replies to (e.g., '1.1').",
          "type": "string"
        },
        "body": {
          "description": "The content of the comment.",
          "type": "string"
        }
      },
      "required": [
        "username",
        "timestamp",
        "body"
      ]
    }
  }
}
